/*
* jQuery.ls_popup.js - popup plugin, specifically to work with asp.net control
*
* version 1.0.0 (2011/08/27) (C)opyright Leon Pennington 2011
* 
* Dual licensed under the MIT and GPL licenses: 
*   http://www.opensource.org/licenses/mit-license.php 
*   http://www.gnu.org/licenses/gpl.html 
*/
;(function($){$.fn.ls_popup=function(args){var opts=$.extend(true,{modal:false,position:"center",relativeto:null,moveelement:null,margin:0,usejqueryoverlay:false,scrolling:true,open:false,opentriggers:null,closetriggers:null,beforeopen:null,afteropen:null,beforeclose:null,afterclose:null,showeffect:null,hideeffect:null},args);this.each(function(){function enableSelect(){var a=$("body")[0];if(typeof a.onselectstart!=null)a.onselectstart=null;else{a.style.MozUserSelect="auto";a.style.webkitUserSelect="auto"}}function disableSelect(){if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection)document.selection.empty();var a=$("body")[0];if(typeof a.onselectstart!=null)a.onselectstart=function(){return false};else{a.style.MozUserSelect="none";a.style.webkitUserSelect="none"}}function mouseUp(a){$(document).unbind(".ls_popup_"+_popup.attr("id"));enableSelect()}function mouseMove(a){var b={x:a.pageX,y:a.pageY};a.cancelBubble=true;a.returnValue=false;var c=_popup.offset();var d=c.left+(b.x-opts.mousepos.x);var e=c.top+(b.y-opts.mousepos.y);opts.mousepos=b;_popup.offset({left:d<0?0:d,top:e<0?0:e});$(window).unbind(".ls_popup_"+_popup.attr("id"))}function hideBackground(){if(opts.usejqueryoverlay){var a=$(".ui-widget-overlay");if(a.length>0){if(opts.bgd_zindex>0)a.css("z-index",opts.bgd_zindex);else a.remove()}}else{var a=$("#ls_popup_bgd").first();if(a.length>0){var b=a.data("using");var c=$.inArray(_popup,b);if(c>=0)b.splice(c,1);if(b.length>0){a.css("z-index",0);for(var c=0;c<b.length;++c){if(b[c].css("z-index")-1>a.css("z-index"))a.css("z-index",b[c].css("z-index")-1)}}else a.css("display","none");a.data("using",b)}}}function setBackground(){if(opts.usejqueryoverlay){var a=$(".ui-widget-overlay");if(a.length>0){opts.bgd_zindex=a.css("z-index");a.css("z-index",_popup.css("z-index")-1)}else{$("<div class='ui-widget-overlay'></div>").insertBefore(_popup);var a=$(".ui-widget-overlay");opts.bgd_zindex=0;a.css({"z-index":_popup.css("z-index")-1,position:"fixed",width:"100%",height:"100%"})}}else{var a=$("#ls_popup_bgd").first();if(a.length>0){a.css("display","block");var b=a.data("using");if($.inArray(_popup,b)<0)b.push(_popup);a.css("z-index",0);for(var c=0;c<b.length;++c){if(b[c].css("z-index")-1>a.css("z-index"))a.css("z-index",b[c].css("z-index")-1)}a.data("using",b)}else{$("<div id='ls_popup_bgd'></div>").insertBefore(_popup);var a=$("#ls_popup_bgd").first();a.css({zIndex:_popup.css("z-index")-1,position:"fixed",left:"0px",top:"0px",backgroundColor:"#000000",width:"100%",height:"100%",opacity:"0.5"});var b=[];b.push(_popup);a.data("using",b)}}}function setPosition(){var a=opts.margin;var b=opts.margin;var c=opts.position.split(",");var d={width:$(window).width(),height:$(window).height(),top:$(window).scrollTop(),left:$(window).scrollLeft()};if(opts.relativeto!=null){var e=$("#"+opts.relativeto);var f=e.offset();if(c.length==1){if(isNaN(c[0])){switch(c[0]){case"center":a=f.left+e.outerWidth()/2-_popup.outerWidth()/2;b=f.top+e.outerHeight()/2-_popup.outerHeight()/2;break;case"left":a=f.left-(e.outerWidth()+parseInt(opts.margin));b=f.top+e.outerHeight()/2-_popup.outerHeight()/2;break;case"right":a=f.left+e.outerWidth()+parseInt(opts.margin);b=f.top+e.outerHeight()/2-_popup.outerHeight()/2;break;case"top":a=f.left+e.outerWidth()/2-_popup.outerWidth()/2;b=f.top-(e.outerHeight()+parseInt(opts.margin));break;case"bottom":a=f.left+e.outerWidth()/2-_popup.outerWidth()/2;b=f.top+e.outerHeight()+parseInt(opts.margin);break}}else{a=f.left+parseInt(c[0]);b=f.top+parseInt(c[0])}}else{if(isNaN(c[0])){switch(c[0]){case"center":a=f.left+e.outerWidth()/2-_popup.outerWidth()/2;break;case"left":a=f.left-(e.outerWidth()+parseInt(opts.margin));break;case"right":a=f.left+e.outerWidth()+parseInt(opts.margin);break}}else a=f.left+parseInt(c[0]);if(isNaN(c[1])){switch(c[1]){case"center":b=f.top+e.outerHeight()/2-_popup.outerHeight()/2;break;case"top":b=f.top-(e.outerHeight()+parseInt(opts.margin));break;case"bottom":b=f.top+e.outerHeight()+parseInt(opts.margin);break}}else b=f.top+parseInt(c[1])}}else{if(c.length==1){if(isNaN(c[0])){switch(c[0]){case"center":a=(d.width-_popup.outerWidth())/2+d.left;b=(d.height-_popup.outerHeight())/2+d.top;break;case"left":a=d.left+opts.margin;b=(d.height-_popup.outerHeight())/2+d.top;break;case"right":a=d.width-_popup.outerWidth()-opts.margin+d.left;b=(d.height-_popup.outerHeight())/2+d.top;break;case"top":a=(d.width-_popup.outerWidth())/2+d.left;b=d.top+opts.margin;break;case"bottom":a=(d.width-_popup.outerWidth())/2+d.left;b=d.height-_popup.outerHeight()-opts.margin+d.top;break}}else{a=c[0]+d.left;b=c[0]+d.top}}else{if(isNaN(c[0])){switch(c[0]){case"center":a=(d.width-_popup.outerWidth())/2+d.left;break;case"left":a=d.left+opts.margin;break;case"right":a=d.width-_popup.outerWidth()-opts.margin+d.left;break}}else a=c[0]+d.left;if(isNaN(c[1])){switch(c[1]){case"center":b=(d.height-_popup.outerHeight())/2+d.top;break;case"top":b=d.top+opts.margin;break;case"bottom":b=d.height-_popup.outerHeight()-opts.margin+d.top;break}}else b=c[0]+d.top}if(_popup.outerHeight()>d.height)b=0}_popup.offset({top:b,left:a})}function postHide(){$(window).unbind(".ls_popup_"+_popup.attr("id"));_popup.unbind("resize");_shownHid.val("false");if(opts.modal)hideBackground();if(opts.hideeffect!=null&&opts.hideeffect.callback!=null)opts.hideeffect.callback();if(opts.afterclose!=null)eval(opts.afterclose())}function hidePopup(){if(opts.beforeclose!=null){if(!opts.beforeclose())return}if(opts.hideeffect!=null)_popup.hide(opts.hideeffect.effect,opts.hideeffect.options,opts.hideeffect.speed,postHide);else{_popup.css("display","none");postHide()}}function postShow(){_shownHid.val("true");$(window).bind("resize.ls_popup_"+_popup.attr("id"),function(a){setPosition()});_popup.bind("resize",function(a){setPosition()});if(opts.scrolling)$(window).bind("scroll.ls_popup_"+_popup.attr("id"),function(a){setPosition()});if(opts.showeffect!=null&&opts.showeffect.callback!=null)opts.showeffect.callback();if(opts.afteropen!=null)opts.afteropen()}function showPopup(a){if(opts.beforeopen!=null){if(!opts.beforeopen())return}_popup.css("display","block");_popup.css("position","absolute");setPosition();if(opts.modal)setBackground();if((a==null||!a)&&opts.showeffect!=null){_popup.css("display","none");_popup.show(opts.showeffect.effect,opts.showeffect.options,opts.showeffect.speed,postShow)}else postShow()}var _popup=$(this);var _shownHid=$("#"+_popup.attr("id")+"_shown");if(_shownHid.val()=="true")showPopup(true);else if(opts.open)showPopup();opts.mousepos=null;if(opts.opentriggers!=null){for(var i=0;i<opts.opentriggers.length;++i){var trig=opts.opentriggers[i];var ctrl=$("#"+trig.control);if(ctrl.length>0){ctrl.get(0).cancelEvent=trig.cancel;ctrl.bind(trig.event,function(a){showPopup();if(this.cancelEvent){if(a&&a.preventDefault)a.preventDefault();return false}})}}}if(opts.closetriggers!=null){for(var i=0;i<opts.closetriggers.length;++i){var trig=opts.closetriggers[i];var ctrl=$("#"+trig.control);if(ctrl.length>0){ctrl.get(0).cancelEvent=trig.cancel;ctrl.bind(trig.event,function(a){hidePopup();if(this.cancelEvent){if(a&&a.preventDefault)a.preventDefault();return false}})}}}if(opts.moveelement!=null){var moveEl=$("#"+opts.moveelement);if(moveEl!=null){moveEl.css("cursor","move");moveEl.mousedown(function(a){opts.mousepos={x:a.pageX,y:a.pageY};$(document).bind("mousemove.ls_popup_"+_popup.attr("id"),mouseMove);$(document).bind("mouseup.ls_popup_"+_popup.attr("id"),mouseUp);a.preventDefault();disableSelect()})}}})}})(jQuery);