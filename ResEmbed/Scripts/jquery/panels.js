/*
* jQuery.ls_panels.js - layout panels plugin
*
* version 1.0.4 (2010/08/09) (C)opyright Leon Pennington 2010
* 
* Dual licensed under the MIT and GPL licenses: 
*   http://www.opensource.org/licenses/mit-license.php 
*   http://www.gnu.org/licenses/gpl.html 
*/
;(function($){$.fn.ls_panels=function(k){var l=$.extend(true,{centrePanel:null,centerPanel:null,barClass:null,ghostDrag:false,ghostOpacity:0.5,store:null,left:{panel:null,resizeable:true,minSize:0,maxSize:0,barClass:null,autoHide:false,pinElem:null,pinElemClass:null},right:{panel:null,resizeable:true,minSize:0,maxSize:0,barClass:null,autoHide:false,pinElem:null,pinElemClass:null}},k);this.each(function(){var f=$(this);var g=null;if(l.centrePanel==null){if(l.centerPanel==null)return;else g=f.children(l.centerPanel)}else g=f.children(l.centrePanel);if(l.store!=null)f.store=$(l.store);g.css("overflow","auto");var h=g.height();var i=null;if(l.left.panel!=null)i=setupPanel(l.left,"left");var j=null;if(l.right.panel!=null)j=setupPanel(l.right,"right");h=f.height()>h?f.height():h;f.height(h);g.height(h);if(i!=null){i.height(h);i.outPnl.height(h);i.bar.height(h)}if(j!=null){j.height(h);j.outPnl.height(h);j.bar.height(h)}calcSizes();$(window).bind("resize",calcSizes);store();function setupPanel(a,b){var c=f.children(a.panel);c.opts=a;c.pos=b;h=c.height()>h?c.height():h;c.css({overflow:"auto",float:"left"});c.outPnl=$("<div style='float:"+b+";'></div>");c.bar=$("<div style='float:left;'><span></span></div>");c.outPnl.append(c);if(b=="left")c.outPnl.append(c.bar);else c.outPnl.prepend(c.bar);c.bar[0].pnl=c;c.outPnl[0].pnl=c;if(b=="left")f.prepend(c.outPnl);else{f.append(c.outPnl);f.append(g)}if(a.resizeable)c.bar.css("cursor","e-resize").bind("mousedown",startDrag);var d=a.barClass!=null?a.barClass:l.barClass;if(d!=null)c.bar.addClass(d);else{c.bar.css({width:"6px",background:"red"});c.bar.hover(function(){$(this).css("background","blue")},function(){$(this).css("background","red")})}c.origWidth=c.width();if(b=="right")c.outPnl.css("right",$(window).width()-(c.outPnl.offset().left+c.outPnl.width()));if(a.autoHide){c.outPnl.css({position:"absolute"});c.outPnl.hover(unhidePanel,hidePanel);c.animate({width:"0px"},0).css("display","none");g.css("padding-"+b,c.bar.outerWidth()+"px")}if(a.pinElem!=null){c.pin=c.find(a.pinElem);c.pin[0].pnl=c;c.pin.click(pinPanel)}return c};function calcSizes(){if(i!=null){i.minDrag=i.offset().left+l.left.minSize;i.maxDrag=l.left.maxSize>0?i.offset().left+l.left.maxSize:f.offset().left+f.innerWidth()}if(j!=null){j.minDrag=f.offset().left+((l.right.maxSize>0)?(f.innerWidth()-l.right.maxSize):0);j.maxDrag=f.offset().left+f.innerWidth()-l.right.minSize}};function startDrag(e){if(e.target!=this)return;f.chgPnl=this.pnl;if(this.pnl.outPnl.css("position")=="absolute")this.pnl.outPnl.unbind("mouseenter mouseleave");if(l.ghostDrag){f.ghost=this.pnl.bar.clone();f.ghost.css({position:"absolute",zindex:100,opacity:l.ghostOpacity});$(f).append(f.ghost);f.ghost.css({top:this.pnl.bar.offset().top+"px",left:this.pnl.bar.offset().left+"px"});f.incr=0}f.initPos=e.pageX;$(document).bind("mousemove",performDrag).bind("mouseup",endDrag);e.preventDefault();disableSelect()};function performDrag(e){if(e.pageX<f.chgPnl.minDrag||e.pageX>f.chgPnl.maxDrag)return;var a=f.initPos-e.pageX;if(l.ghostDrag){var b=f.ghost.offset();b.left-=a;f.incr+=a;f.ghost.offset(b)}else{if(f.chgPnl.pos=="left")a=0-a;f.chgPnl.width(f.chgPnl.width()+a)}f.initPos=e.pageX};function endDrag(e){$(document).unbind("mousemove",performDrag).unbind("mouseup",endDrag);if(l.ghostDrag){if(f.chgPnl.pos=="left")f.incr=0-f.incr;f.chgPnl.width(f.chgPnl.width()+f.incr);f.ghost.remove()}f.chgPnl.origWidth=f.chgPnl.width();if(f.chgPnl.outPnl.css("position")=="absolute")f.chgPnl.outPnl.hover(unhidePanel,hidePanel);store();enableSelect()};function disableSelect(){if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection)document.selection.empty();var a=$("body")[0];if(typeof a.onselectstart!=null)a.onselectstart=function(){return false};else{a.style.MozUserSelect="none";a.style.webkitUserSelect="none"}};function enableSelect(){var a=$("body")[0];if(typeof a.onselectstart!=null)a.onselectstart=null;else{a.style.MozUserSelect="auto";a.style.webkitUserSelect="auto"}};function unhidePanel(e){this.pnl.stop(true);this.pnl.delay(400).show(1).animate({width:this.pnl.origWidth+"px"},"slow")};function hidePanel(e){this.pnl.stop(true);clearTimeout(this.pnl.timout);this.pnl.delay(400).animate({width:"0px"},"slow").hide(1)};function pinPanel(e){if(this.pnl.outPnl.css("position")=="absolute"){this.pnl.outPnl.css("position","static");this.pnl.outPnl.unbind("mouseenter mouseleave");if(this.pnl.opts.pinElemClass!=null)this.pnl.pin.addClass(this.pnl.opts.pinElemClass);g.css("padding-"+this.pnl.pos,"0")}else{this.pnl.outPnl.css("position","absolute");this.pnl.outPnl.hover(unhidePanel,hidePanel);if(this.pnl.opts.pinElemClass!=null)this.pnl.pin.removeClass(this.pnl.opts.pinElemClass);g.css("padding-"+this.pnl.pos,this.pnl.bar.outerWidth()+"px")}store()};function store(){if(l.store==null)return;var a="";if(i!=null)a="left{width:"+i.origWidth+",autoHide:"+((i.outPnl.css("position")=="absolute")?"true":"false")+"}";a+=";";if(j!=null)a+="right{width:"+j.origWidth+",autoHide:"+((j.outPnl.css("position")=="absolute")?"true":"false")+"}";f.store.val(a)}})}})(jQuery);